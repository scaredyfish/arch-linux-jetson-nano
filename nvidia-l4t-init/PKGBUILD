# Generated by debtap
# Maintainer: Scaredyfish
# Contributor: Scaredyfish
pkgname=nvidia-l4t-init
pkgver=32.7.3
pkgrel=1
pkgdesc="NVIDIA Init debian package."
arch=('aarch64')
url="http://developer.nvidia.com/jetson"
license=('nVidia')
groups=('')
depends=('nvidia-l4t-core<32.8' 'nvidia-l4t-core>32.7')
backup=('etc/asound.conf.tegrahda' 'etc/asound.conf.tegrasndt210ref' 'etc/default/rng-tools' 'etc/enctune.conf' 'etc/lightdm/lightdm.conf.d/50-nvidia.conf' 'etc/modprobe.d/bcmdhd.conf' 'etc/nv/nvfirstboot' 'etc/nvidia-container-runtime/host-files-for-container.d/l4t.csv' 'etc/nvphsd.conf' 'etc/nvphsd_common.conf' 'etc/sysctl.d/90-tegra-settings.conf' 'etc/systemd/nv-late-init.sh' 'etc/systemd/nv.sh' 'etc/systemd/nvfb.sh' 'etc/systemd/nvgetty.sh' 'etc/systemd/nvmemwarning.sh' 'etc/systemd/nvzramconfig.sh' 'etc/systemd/system/nv-late-init.service' 'etc/systemd/system/nv.service' 'etc/systemd/system/nvfb.service' 'etc/systemd/system/nvgetty.service' 'etc/systemd/system/nvmemwarning.service' 'etc/systemd/system/nvphs.service' 'etc/systemd/system/nvs-service.service' 'etc/systemd/system/nvzramconfig.service' 'etc/udev/rules.d/90-alsa-asound-tegra.rules' 'etc/udev/rules.d/91-xorg-conf-tegra.rules' 'etc/udev/rules.d/92-hdmi-audio-tegra.rules' 'etc/udev/rules.d/99-nv-l4t-usb-device-mode.rules' 'etc/udev/rules.d/99-nv-l4t-usb-host-config.rules' 'etc/udev/rules.d/99-nv-ufs-mount.rules' 'etc/udev/rules.d/99-nv-wifibt.rules' 'etc/udev/rules.d/99-tegra-devices.rules' 'etc/udev/rules.d/99-tegra-mmc-ra.rules' 'etc/wpa_supplicant.conf' 'etc/xdg/autostart/nvchrome.desktop' 'etc/xdg/autostart/nvchrome.sh')
options=('!strip' '!emptydirs')
install=${pkgname}.install
source=("https://repo.download.nvidia.com/jetson/t210/pool/main/n/nvidia-l4t-init/nvidia-l4t-init_32.7.3-20221122092935_arm64.deb")
sha512sums=('26644f19ffffce621a8038ce717288c88889ea4a3f4f379535ca8cbbf61a52a9dc25b74e136742e0ad9b41ef75ed3982689ab1dbd420fa8a6b517134c9a655c8')

package(){

	# Extract package data
	tar -xI unzstd -f data.tar.zst -C "${pkgdir}"

	# Fix directory structure differences
	cd "${pkgdir}"

	install -D -m644 "${pkgdir}/opt/nvidia/l4t-usb-device-mode/LICENSE.filesystem.img" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
	install -D -m644 "${pkgdir}/usr/share/doc/rng-tools/copyright" "${pkgdir}/usr/share/licenses/${pkgname}/COPYRIGHT"
	mkdir usr/bin -p 2> /dev/null; mv usr/sbin/* usr/bin; rm -rf usr/sbin

	# Don't overwrite default sleep.conf
	mkdir -p etc/systemd/sleep.conf.d
	mv etc/systemd/sleep.conf etc/systemd/sleep.conf.d/99-nvidia.sleep.conf
	
	cd ..

}
